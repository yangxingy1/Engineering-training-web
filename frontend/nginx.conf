# frontend/nginx.conf

server {
    # 监听容器内的 80 端口
    listen 80;

    # 网站文件的根目录
    root /usr/share/nginx/html;
    # 默认主页文件
    index home.html;

    # 规则1: 处理静态文件请求
    # 当用户访问根路径 (http://your-ip/) 时
    location / {
        # 尝试按顺序查找文件: $uri (请求的文件), $uri/ (请求的目录)
        # 如果都找不到，则返回 home.html (这对于单页应用很重要)
        try_files $uri $uri/ /home.html;
    }

    # 规则2: 处理 API 请求 (这是关键)
    # 当用户请求的路径以 /api 开头时
    location /api {
        # 将这个请求"转发"给名为 "backend" 的服务的 8000 端口
        # "backend" 这个名字将在 docker-compose.yml 文件中定义
        proxy_pass http://backend:8000;

        # 以下是标准的代理头信息设置，确保后端能获取到真实的请求信息
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}